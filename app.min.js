function initializeWalkthrough(e){$.ajax({url:_spPageContextInfo.webAbsoluteUrl+"_api/SP.UserProfiles.PeopleManager/GetMyProperties/AccountName",type:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(t){$.ajax({url:_spPageContextInfo.webAbsoluteUrl+"/_api/web/ensureuser",type:"POST",data:JSON.stringify({logonName:t.d.AccountName}),headers:{"X-RequestDigest":$("#__REQUESTDIGEST").val(),Accept:"application/json; odata=verbose","content-type":"application/json;odata=verbose"},success:function(t){var o=_spPageContextInfo.webAbsoluteUrl+"/_api/web/lists/lists('"+_TRACKER_LIST_ID+"')/items?$filter=(StaffId eq "+t.d.Id+" AND walkName eq '"+e+"')&$select=WalkName,StaffId,Completed,Cancelled&$expand=Staff";$.ajax({url:o,type:"GET",StaffId:t.d.Id,headers:{Accept:"application/json; odata=verbose"},success:function(t){var o=t.d.results;if(o.length>0)$.each(o,function(t,o){"Yes"!=o.Completed&&"Yes"!=o.Cancelled&&runWalkthrough(e)});else{var a={__metadata:{type:"SP.Data.TutorialTrackerListItem"},StaffId:StaffId,WalkName:e,Completed:"No",Cancelled:"No"};$.ajax({url:listURL,method:"POST",data:JSON.stringify(a),headers:{"X-RequestDigest":$("#__REQUESTDIGEST").val(),accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose"},success:onCreateJSON,error:onQueryFailedJSON})}},error:onQueryFailedJSON})},error:onQueryFailedJSON})},error:onQueryFailedJSON})}function runWalkthrough(e){this.arrSteps=[];var t=_spPageContextInfo.webAbsoluteUrl+"/_api/web/lists/lists('"+_ITEM_LIST_ID+"')/items?$filter=(walkName='"+e+"')&$select=WalkName,Selector,Index,Message&$orderby=Index asc";$.ajax({url:t,type:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(e){var t=e.d.results;t.length>0&&($.each(t,function(e,t){arrSteps.push(t)}),showWalkBox(arrSteps[0].Message,arrSteps[1].Selector))},error:onQueryFailedJSON})}function nextWalkBox(e){$(selector).css("pointer-events","auto")}function showWalkBox(e,t){$(t).addClass("expose"),$(t).css("pointer-events","none"),$(this).append($("<div/>",{class:"modal-dialog"}).html('<div class="modal-header"><h2>Modal in CSS?</h2><a href="#" class="btn-close" aria-hidden="true">Ã—</a></div><div class="modal-body"><p>One modal example here! :D</p></div><div class="modal-footer"><a href="#" class="btn">Nice!</a></div>'))}function onCreateJSON(e){console.log("itemID "+e.d.ID+" created")}function onQueryFailedJSON(e,t,o){null!=e.responseJSON?console.log(e.responseJSON.error.code+": "+e.responseJSON.error.message.value):console.log(e)}function scrollLock(e){e?($("body").css({overflow:"hidden"}),$(document).bind("scroll",function(){window.scrollTo(window.pageXOffset,window.pageYOffset)})):($(document).unbind("scroll"),$("body").css({overflow:"visible"}))}function walkNext(e){if(scrollLock(!1),$(".btn").data("id","#"+e.nextAll("h3").eq(0).attr("id")),$(".expose").removeClass("expose"),e.addClass("expose"),$("#modal-one p").html(e.html()),isElementInViewport(e)||$("html,body").animate({scrollTop:e.offset().top}),$("html,body").promise().done(function(){var e=getAnchor($(".modal-dialog"),_anchor);$("#modal-one").addClass("walk"),console.log($(".modal-dialog")[0].getBoundingClientRect()),console.log($(".modal-dialog")[0].getBoundingClientRect()),$(".modal-dialog").animate(e),scrollLock(!0)}),$(window).width()*$(window).height()<$(".modal-dialog").width()*$(".modal-dialog").height()+e.width()*e.height())return!1}function getAnchor(e,t){var o={TL:"top left",T:"top center",TR:"top right",CL:"center left",C:"center",CR:"center right",BL:"bottom left",B:"bottom center",BR:"bottom right"};if(!o[t])return!1;var a={};switch(o[t]){case"top left":a.top="0px",a.left="0px";break;case"top center":a.top="0px",a.left=Math.round(($(window).width()-e.width())/2)+"px";break;case"top right":a.top="0px",a.right="0px";break;case"center left":a.top=Math.round(($(window).height()-e.height())/2)+"px",a.left="0px";break;case"center":a.top=Math.round(($(window).height()-e.height())/2)+"px",a.left=Math.round(($(window).width()-e.width())/2)+"px";break;case"center right":a.top=Math.round(($(window).height()-e.height())/2)+"px",a.right="0px";break;case"bottom left":a.left="0px",a.bottom="0px";break;case"bottom center":a.left=Math.round(($(window).width()-e.width())/2)+"px",a.bottom="0px";break;case"bottom right":a.bottom="0px",a.right="0px";break;default:a.top=Math.round(($(window).height()-e.height())/2)+"px",a.left=Math.round(($(window).width()-e.width())/2)+"px"}return a}function getArea(e){return e instanceof jQuery?e.width()*e.height():e.style.width*e.style.height}function isOverlap(e,t,o){if(!isElementInViewport(e)&&void 0===o||!isElementInViewport(t))return!1;var a=e[0].getBoundingClientRect(),n=t[0].getBoundingClientRect();if(null!==o&&void 0!==o){var l={};return void 0!==o.top?(l.top=parseFloat(o.top),l.bottom=a.bottom+a.top-l.top):(l.bottom=parseFloat(o.bottom),l.top=a.top+a.bottom-l.bottom),void 0!==o.right?(l.right=parseFloat(o.right),l.left=a.left+a.right-l.right):(l.left=parseFloat(o.left),l.right=a.right+a.left-l.left),console.log(a),console.log(l),console.log(n),!(l.right<n.left||l.left>n.right||l.bottom<n.top||l.top>n.bottom)}return!(a.right<n.left||a.left>n.right||a.bottom<n.top||a.top>n.bottom)}function isElementInViewport(e){"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}var _TRACKER_LIST_ID="072f3846-7046-4ae3-a492-15325b2ef308",_ITEM_LIST_ID="b568df2e-fb1d-47cb-898c-5c45d1faf616",arrSteps=[],_anchor="CR";$(document).ready(function(){$(".scroll").click(function(e){e.preventDefault(),walkNext($(this.hash)),e.stopPropagation()}),$("#modal-one a.btn").click(function(e){e.preventDefault(),walkNext($($(this).data("id"))),e.stopPropagation()}),$(".modal a.btn-close").click(function(e){e.preventDefault(),scrollLock(!1),$("#modal-one").removeClass("walk"),$(".modal-dialog").addClass("idle"),$(".modal-dialog").css("top",""),$(".modal-dialog").css("right",""),$(".modal-dialog").css("bottom",""),$(".modal-dialog").css("left",""),e.stopPropagation()})});